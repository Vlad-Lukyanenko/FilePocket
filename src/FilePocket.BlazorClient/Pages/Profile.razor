@page "/profile"
@using FilePocket.BlazorClient.Features.Users.Requests
@using Microsoft.AspNetCore.Components.Routing

<div class="container-fluid">
    <div class="container-fluid w-100 w-md-75">

        <TopSubMenu Title="Profile" ShowBackButton="false"/>

        @if (_isLoading)
        {
            <!-- Loading Spinner -->
            <div class="container-fluid w-100 h-100 text-center p-4 d-flex justify-content-center align-items-center">
                <div class="spinner-grow" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        }else{
            <!-- Form Container -->
            <div class="">
                    <h5 class="card-title text-center mb-4">Edit Profile</h5>

                    <div class="d-flex flex-column justify-content-center align-items-center">
                        
                        <label class="img-container" title="Change avatar">
                            <img class="rounded-circle image" src="@GetProfileIcon()" alt="userPicture">
                            <div class="d-flex align-items-end justify-content-center overlay">
                                <i class="bi bi-camera"></i>
                            </div>
                            <InputFile hidden id="fileInput" OnChange="UploadFilesAsync" accept=".png, .jpg, .jpeg" />
                        </label>

                        <div class="form-group">
                            <label class="fw-semibold">Email:</label>
                            <input type="text" class="form-control" value="@_profile.Email" disabled />
                        </div>

                         <div class="form-group">
                            <label for="firstName" class="fw-semibold">Name:</label>
                            <input type="text" class="form-control" @bind="_profile.FirstName" id="firstName" disabled="@( !isEditing )" >                                        
                            
                        </div>
                                            
                        <div class="form-group">
                            <label for="lastName" class="fw-semibold">Surname:</label>
                            <input type="text" class="form-control" @bind="_profile.LastName" id="lastName" disabled="@( !isEditing )">
                            
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" class="fw-semibold">Number:</label>
                            <input type="tel" class="form-control" @bind="_profile.PhoneNumber" id="phone" placeholder="+1 (555) 123-4567" disabled="@( !isEditing )">
                            
                        </div>

                        <div class="form-group">
                            <label for="birthDate" class="fw-semibold">Birthday:</label>
                            <input type="date" class="form-control" @bind="_profile.BirthDate" id="birthDate" disabled="@( !isEditing )">
                            
                        </div>

                        <div class="dropdown form-group">
                            <button class="btn dropdown-toggle fw-semibold" type="button" data-bs-toggle="dropdown" style="color: #6c63ff; border: 2px solid #6c63ff;">
                                @selectedLanguage
                            </button>
                            <ul class="dropdown-menu">
                                @foreach (var lang in languages)
                                    {
                                        <li>
                                            <button class="dropdown-item" @onclick="() => SelectLanguage(lang.Key)">
                                                @lang.Value
                                            </button>
                                        </li>
                                    }
                            </ul>

                             <!-- Edit / Save Button -->
                            <div class="d-flex justify-content-end">
                                <button class="btn @(isEditing ? "btn-success" : "btn-primary") px-4" @onclick="ToggleEditMode">
                                    @(isEditing ? "Save" : "Edit")
                                </button>
                            </div>
                        </div>
                  
                    </div>
            </div>
            
        }

        <!-- Error Block -->
        @if (_fileUploadErrors.Any())
        {
            <div class="fixed-bottom p-3">
                @foreach (var fileUploadError in _fileUploadErrors)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Holy guacamole!</strong> Looks like file upload for @fileUploadError.OriginalName went wrong. @fileUploadError.ErrorMessage
                        <button type="button"
                                class="btn-close"
                                aria-label="Close"
                                @onclick="() => RemoveError(fileUploadError)">
                        </button>
                    </div>
                }
            </div>
        }

        <div class="alert alert-success alert-dismissible fade show" role="alert" style="@_alertStyle">x
            <strong>@_alertMessage</strong>
            <button type="button" class="btn-close" aria-label="Close" @onclick="CloseAlert"></button>
        </div>
        
    </div>
</div>



@code {
    private string selectedLanguage = "English";
    private Dictionary<string, string> languages = new()
    {
        { "en", "English" },
        { "ua", "Ukrainian" },
        { "ru", "Russian" }
    };

    private void SelectLanguage(string lang)
    {
        selectedLanguage = languages[lang];
        // Логика для сохранения выбора (например, в localStorage или API)
    }
}